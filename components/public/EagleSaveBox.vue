<template> <div class="onlineGallery-modal"> <el-dialog class="onlineGallery-dialog" style="pointer-events: auto !important; padding: 0px" v-model="eagleStore.saveBoxContainer.open" :width="appInfo.window.width > 800 ? '800px' : '100%'" :modal="false" :close-on-click-modal="false" :lock-scroll="false" destroy-on-close draggable :before-close="handleClose" @open="handleOpen" @closed="handleClosed" :z-index="0" @open-auto-focus="handleFocused" @close-auto-focus="handleCloseFocused" > <template #header> <span style="color: black; font-size: large">选择保存位置</span> </template> <template #default> <el-container style="user-select: none"> <el-aside width="400px" show-checkbox highlight-current style="padding: 5px" > <el-input clearable v-model="treeQuery" placeholder="输入关键词" @input="onQueryChanged" /> <el-tree-v2 ref="treeRef" :data="treeData" :props="treeProps" :height="400" highlight-current :filter-method="treeFilterMethod" @node-click="treeNodeClick" :item-size="32" show-checkbox > <template #default="{node}"> <div v-if="node.key != '#'" class="tree-item tree-item-normal" > <el-tooltip :show-after="500" effect="dark" :content="node.label" placement="top" > <span class="tree-node-label">{{ node.label }}</span> </el-tooltip> </div> </template> </el-tree-v2> </el-aside> <el-main style="padding: 5px"> </el-main> </el-container> </template> <template #footer> <el-button type="primary" @click="submit" > 提交 </el-button> <el-button @click="eagleStore.saveBoxContainer.open = false">取消</el-button> </template> </el-dialog> </div></template><script setup lang="ts"> import type {TreeNode, TreeNodeData} from "element-plus/es/components/tree-v2/src/types"; import {IEagleLibraryData, IEagleFolder} from "@/ts/class/EagleAPI"; const appInfo = useAppInfoStore(); const eagleStore = useEagleStore(); const eagle = eagleStore.eagle; const data = ref<IEagleLibraryData>({ folders: <IEagleFolder[]>[], smartFolders: [], quickAccess: [], tagsGroups: [], modificationTime: <number>0, applicationVersion: <string>"none", library: { path: <string>"none", name: <string>"none", }, }); const treeQuery = ref(""); const treeProps = ref({ value: "id", label: "name", children: "children", disabled: "disabled", }); const treeData = computed(() => { let result = data.value.folders; return result; }); async function handleOpen() { await nextTick(); await getEagleLibraryInfo(); } onMounted(async () => { await nextTick(); await getEagleLibraryInfo(); }); async function getEagleLibraryInfo() { if (!(await eagle.queryAppIsOnline())) { console.log("eagle不在线或无法找到"); return; } let libraryInfo = await eagle.getLibraryInfo(); if (libraryInfo) { data.value = libraryInfo; console.log("eagle libraryInfo 获取成功"); } else { console.log("eagle libraryInfo 获取失败"); } } async function submit() { console.log("提交结果"); eagleStore.saveBoxContainer.open = false; } const treeRef = ref(); function onQueryChanged(query: string) { treeRef.value.filter(query); } function treeFilterMethod(query: string, node: any): boolean { return node.name!.includes(query); } function treeNodeClick(nodeData: TreeNodeData, node: TreeNode, e: MouseEvent) { } function handleClose() { console.log("准备关闭"); } function handleClosed() { console.log("已关闭"); } function handleFocused() {} function handleCloseFocused() {}</script><style lang="scss" scoped> .onlineGallery-modal { & { pointer-events: none !important; } .onlineGallery-dialog { &:focus { z-index: 1; } } }</style>