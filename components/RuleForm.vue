<template><el-tabs v-model="info.activeName" type="border-card" @tab-click="" v-if="formData != undefined"><el-tab-pane label="首选项" name="main"><el-form :model="formData.main" label-width="100px"><el-form-item label="规则名称"><el-input v-model="formData.main.name" /></el-form-item><el-form-item label="根网址"><el-input v-model="formData.main.domainName" /></el-form-item><el-form-item label="路径过滤器"><el-input v-model="formData.main.pathFilter" /></el-form-item><el-form-itemlabel="标题选择器"><span style="flex-grow: 1"><el-input v-model="formData.main.titleSelector" type="text" /></span></el-form-item></el-form></el-tab-pane><el-tab-pane label="dom限定" name="domItem"><el-form :model="formData.domItem" label-width="100px"><el-form-item label="启用"><el-checkbox v-model="formData.domItem.enable" type="checkbox" /></el-form-item><el-form-item:label="`css选择器${index + 1}`"v-if="formData.domItem.enable"v-for="(selector, index) in formData.domItem.selector":key="index"><span style="flex-grow: 1"><el-input v-model="formData.domItem.selector[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item></el-form></el-tab-pane><el-tab-pane label="链接(必填)" name="linkUrl"><el-form :model="formData.linkUrl" label-width="100px"><el-form-item:label="`css选择器${index + 1}`"v-for="(selector, index) in formData.linkUrl.selector":key="index"><span style="flex-grow: 1"><el-input v-model="formData.linkUrl.selector[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item><el-form-item label="提取类型"><el-select v-model="formData.linkUrl.infoType" placeholder="选择要提取的类型"><el-option :value="1" label="值" /><el-option :value="2" label="Attribute属性" /><el-option :value="3" label="Property属性" /><el-option :value="4" label="innerText 内部文本" /><el-option :value="5" label="innerHTML 内部HTML" /><el-option :value="6" label="outerHTML 全部HTML" /></el-select></el-form-item><el-form-item:label="`匹配属性${index + 1}`"v-for="(attribute, index) in formData.linkUrl.attribute":key="index"><span style="flex-grow: 1"><el-input v-model="formData.linkUrl.attribute[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item></el-form></el-tab-pane><el-tab-pane label="图链" name="picUrl"><el-form :model="formData.picUrl" label-width="100px"><el-form-item label="启用"><el-checkbox v-model="formData.picUrl.enable" type="checkbox" /></el-form-item><el-form-item:label="`css选择器${index + 1}`"v-if="formData.picUrl.enable"v-for="(selector, index) in formData.picUrl.selector":key="index"><span style="flex-grow: 1"><el-input v-model="formData.picUrl.selector[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item><el-form-item label="提取类型" v-if="formData.picUrl.enable"><el-select v-model="formData.picUrl.infoType" placeholder="选择要提取的类型"><el-option :value="1" label="值" /><el-option :value="2" label="Attribute属性" /><el-option :value="3" label="Property属性" /><el-option :value="4" label="innerText 内部文本" /><el-option :value="5" label="innerHTML 内部HTML" /><el-option :value="6" label="outerHTML 全部HTML" /></el-select></el-form-item><el-form-itemv-if="formData.picUrl.enable":label="`匹配属性${index + 1}`"v-for="(attribute, index) in formData.picUrl.attribute":key="index"><span style="flex-grow: 1"><el-input v-model="formData.picUrl.attribute[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item></el-form></el-tab-pane><el-tab-pane label="名称" name="name"><el-form :model="formData.name" label-width="100px"><el-form-item label="启用"><el-checkbox v-model="formData.name.enable" type="checkbox" /></el-form-item><el-form-item:label="`css选择器${index + 1}`"v-if="formData.name.enable"v-for="(selector, index) in formData.name.selector":key="index"><span style="flex-grow: 1"><el-input v-model="formData.name.selector[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item><el-form-item label="提取类型" v-if="formData.name.enable"><el-select v-model="formData.name.infoType" placeholder="选择要提取的类型"><el-option :value="1" label="值" /><el-option :value="2" label="Attribute属性" /><el-option :value="3" label="Property属性" /><el-option :value="4" label="innerText 内部文本" /><el-option :value="5" label="innerHTML 内部HTML" /><el-option :value="6" label="outerHTML 全部HTML" /></el-select></el-form-item><el-form-itemv-if="formData.name.enable":label="`匹配属性${index + 1}`"v-for="(attribute, index) in formData.name.attribute":key="index"><span style="flex-grow: 1"><el-input v-model="formData.name.attribute[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item></el-form></el-tab-pane><el-tab-pane label="元信息" name="meta"><el-form :model="formData.meta" label-width="100px"><el-form-item label="启用"><el-checkbox v-model="formData.meta.enable" type="checkbox" /></el-form-item><el-form-item label="提取类型" v-if="formData.meta.enable"><el-select v-model="formData.meta.origin" placeholder="提取来源"><el-option :value="0" label="单独指定目标dom" /><el-option :value="1" label="从“链接”dom获取" /><el-option :value="2" label="从“图链”dom获取" /><el-option :value="3" label="从“名称”dom获取" /></el-select></el-form-item><el-form-item:label="`css选择器${index + 1}`"v-if="formData.meta.enable && formData.meta.origin === 0"v-for="(selector, index) in formData.meta.selector":key="index"><span style="flex-grow: 1"><el-input v-model="formData.meta.selector[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item><el-form-item label="提取类型" v-if="formData.meta.enable"><el-select v-model="formData.meta.infoType" placeholder="选择要提取的类型"><el-option :value="1" label="值" /><el-option :value="2" label="Attribute属性" /><el-option :value="3" label="Property属性" /><el-option :value="4" label="innerText 内部文本" /><el-option :value="5" label="innerHTML 内部HTML" /><el-option :value="6" label="outerHTML 全部HTML" /></el-select></el-form-item><el-form-itemv-if="formData.meta.enable":label="`匹配属性${index + 1}`"v-for="(attribute, index) in formData.meta.attribute":key="index"><span style="flex-grow: 1"><el-input v-model="formData.meta.attribute[index]" type="text" /></span><span class="side-button add-match-item"><HoverButton @click="pushMatchItem(index)"><template #default><el-icon><i-ep-CirclePlus /></el-icon></template><template #hover><el-icon><i-ep-CirclePlusFilled /></el-icon></template></HoverButton></span><span class="side-button remove-match-item"><HoverButton @click="removeMatchItem(index)"><template #default><el-icon><i-ep-Remove /></el-icon></template><template #hover><el-icon><i-ep-RemoveFilled /></el-icon></template></HoverButton></span></el-form-item></el-form></el-tab-pane></el-tabs></template><script setup lang="ts">import {Rule} from "../js/class/Rule";const props = defineProps({formData: {type: Rule,},});const info = reactive({activeName: "main",});const pushMatchItem = (index: number): void => {const rule = props.formData;for (const key of rule.enumMainKey) {for (const item of Object.keys(rule[key])) {if (rule.enumMatchItemKey.includes(item)) {rule[key][item].splice(index + 1, 0, "");}}}rule.matchItemCount++;};const removeMatchItem = (index: number): void => {const rule = props.formData;if (rule.matchItemCount <= 1) {return;}for (const key of rule.enumMainKey) {for (const item of Object.keys(rule[key])) {if (rule.enumMatchItemKey.includes(item)) {rule[key][item].splice(index, 1);}}}rule.matchItemCount--;};watch(() => props.formData,(newVal, oldVal) => {console.log("当前表格的规则数据", props.formData);info.activeName = "main";});</script><style lang="scss" scoped>.side-button {position: relative;width: 24px;aspect-ratio: 1;display: flex;justify-content: center;align-items: center;font-size: 18px;&.add-match-item {color: green;}&.remove-match-item {color: red;}}</style>