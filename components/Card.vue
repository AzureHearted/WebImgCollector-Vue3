<template><div ref="cardRef" class="onlineGallery-card" @contextmenu.prevent.self><aclass="card-FancyBox-anchor"data-onlineGallery-fancybox="onlineGallery":data-type="card.fancyBoxType":href="card.linkUrl":data-thumb="card.picUrl":data-width="card.fancyBoxType == 'image' || card.fancyBoxType == 'video'? card.meta.width: null":data-height="card.fancyBoxType == 'image' || card.fancyBoxType == 'video'? card.meta.height: null"></a><transition><div class="onlineGallery-card-body" v-if="card.visible || visibility"><Imgclass="content":src="card.picUrl":width="card.meta.width":height="card.meta.height"></Img></div></transition><transition><div class="onlineGallery-card-other" v-if="card.visible || visibility"><div class="tag-group"><el-tooltipv-if="card.linkBlob"effect="dark":content="(card.linkBlob.size / 1024 / 1024).toFixed(2) + 'Mb'"placement="top"><el-tagclass="el-tag"roundsize="small"@click.right="copyTagContent((card.linkBlob.size / 1024 / 1024).toFixed(2) + 'Mb')">{{ (card.linkBlob.size / 1024 / 1024).toFixed(2) + "Mb" }}</el-tag></el-tooltip><el-tooltipeffect="dark":content="`${card.meta.width}x${card.meta.height}`"placement="top"><el-tagclass="el-tag"size="small"type="info"@click.right="copyTagContent(card.meta.width + 'x' + card.meta.height)"round>{{ card.meta.width }}x{{ card.meta.height }}</el-tag></el-tooltip><el-tooltip effect="dark" :content="card.name" placement="top"><el-tagclass="el-tag"roundsize="small"@click.right="copyTagContent(card.name)">{{ card.name }}</el-tag></el-tooltip></div><el-checkbox v-model="card.selected" class="checkbox" /><div class="button-group"><el-buttonclass="button download"type="primary"circle@click.stop="download":loading="downloading"><template #icon><el-icon><i-ep-Download /></el-icon></template></el-button><el-buttonclass="button toPosition"type="primary"circle@click.stop="toPosition":loading="downloading"><template #icon><el-icon><i-ep-LocationFilled /></el-icon></template></el-button></div></div></transition></div></template><script setup lang="ts">const {text, isSupported, copy} = useClipboard(); interface Props {card: matchCard;index: number;}const props = withDefaults(defineProps<Props>(), {card: () => {return {name: "",linkUrl: "",picUrl: "",originUrls: [],metaOrigin: "",meta: <metaInterFace>{width: 0,height: 0,aspectRatio: 3 / 4,},picBlob: new Blob([], {type: "none"}),linkBlob: new Blob([], {type: "none"}),nameBlob: new Blob([], {type: "none"}),selected: false, dom: null,visible: false,match: false,fancyBoxType: "image",};},});const appInfo = useAppInfoStore();const downloading = ref(false); const cardRef = ref<HTMLElement | null>();const visibility = useElementVisibility(cardRef);const {stop} = useIntersectionObserver(cardRef,([{isIntersecting}], observerElement) => {props.card.visible = isIntersecting;},{immediate: false,root: document.querySelector("#onlineGallery-container") as HTMLElement,rootMargin: "100px 0px 100px 0px",});const copyTagContent = async (content: string) => {await copy(content);ElMessage({type: "success",grouping: true,center: true,duration: 1000,offset: 120,message: h("p", {style: "display:flex;gap:10px"}, [h("i", {style: "color: teal"}, content),h("span", {style: "color: black"}, "复制成功！"),]),});};const download = async () => {const card = props.card;downloading.value = true;if (card.linkBlob) {let ext = getExtByBlob(card.linkBlob);console.log(ext);let reg = new RegExp(`(\\.${ext})+$`);await saveAs(card.linkBlob, `${card.name.replace(reg, "")}.${ext}`);downloading.value = false;} else {const url = card.linkUrl;let tempBlob: Blob = await getBlobByUrlAuto(url);console.log(tempBlob);if (tempBlob && tempBlob.type !== "none") {card.linkBlob = tempBlob;let ext = getExtByBlob(card.linkBlob);console.log(ext);let reg = new RegExp(`(\\.${ext})+$`);await saveAs(card.linkBlob, `${card.name.replace(reg, "")}.${ext}`);downloading.value = false;} else {downloading.value = false;}}};const toPosition = async () => {const dom = props.card.dom;if (dom != null) {appInfo.container.open = !appInfo.container.open;dom.scrollIntoView({behavior: "smooth",block: "center",inline: "center",});}};</script><style scoped lang="scss">* {border: 0;margin: 0;box-sizing: border-box;}.onlineGallery-card {border: 0 !important;margin: 0 !important;padding: 0 !important;scroll-snap-align: start;position: relative;border-radius: 4px;box-shadow: var(--el-box-shadow-dark);aspect-ratio: var(--aspect-ratio) !important;max-width: 100%;$height: max(var(--cardMaxHeight), 200px);max-height: $height;width: calc($height * var(--aspect-ratio)) !important;background-color: transparent;overflow: hidden;cursor: pointer;transition: 0.25s;&:hover {box-shadow: 1px 2px 12px 6px rgba(0, 0, 0, 0.5);}.card-FancyBox-anchor {position: absolute !important;width: 100%;height: 100%;z-index: 1;}.content {border: 0 !important;margin: 0 !important;padding: 0 !important;width: 100%;height: auto;object-position: center;-webkit-user-drag: none;background-position: center;background-repeat: repeat;background-size: contain;}.button-group {& {position: absolute;$padding: 4px;$margin: 4px;margin: $margin;top: 0;right: 0;width: 24px;height: 24px;border-radius: 12px;transition: 0.15s;z-index: 1;}.button {position: absolute;margin: auto;padding: 0;left: 0;top: 0;right: 0;width: 100% !important;height: auto !important;aspect-ratio: 1 !important;font-size: medium;box-shadow: var(--el-box-shadow-light);transition: 0.15s;}&:hover {& {height: 24px + 26px;}.button.download {transform: translateY(26px);}}@media (max-width: 500px) {& {height: 24px + 26px !important;}.button.download {transform: translateY(26px) !important;}}}.checkbox {position: absolute !important;height: fit-content;top: 4px !important;left: 4px !important;box-shadow: var(--el-box-shadow-light);z-index: 1;}.tag-group {position: absolute;width: 100% !important;bottom: 0px;left: 0px;padding: 4px;display: flex;flex-flow: row wrap;gap: 2px;z-index: 1;.el-tag {max-width: 100%;justify-content: start;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}}}.v-enter-active,.v-leave-active {transition: opacity 0.25s ease;}.v-enter-from,.v-leave-to {opacity: 0;}</style>