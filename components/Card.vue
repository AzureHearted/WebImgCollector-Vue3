<template><div class="card" @contextmenu.prevent.self @click="clickHandle"><Img class="content" :src="card.url"></Img><div class="tag-group"><el-tagclass="tag-width-and-height"roundsize="small"type="info"@click.right.prevent="copyTagContent(`${card.width}x${card.height}`)">{{ card.width }}x{{ card.height }}</el-tag><el-tagclass="tag-width-and-height"roundsize="small"@click.right.prevent="copyTagContent(card.name)">{{ card.name }}</el-tag></div><el-checkbox v-model="card.selected" class="checkbox" size="default" /><div class="button-group"><el-buttonclass="button download"type="primary"size="small"circle@click.stop="download":loading="downloading"><template #icon><el-icon><i-ep-Download /></el-icon></template></el-button><el-buttonclass="button toPosition"type="primary"size="small"circle@click.stop="toPosition":loading="downloading"><template #icon><el-icon><i-ep-LocationFilled /></el-icon></template></el-button></div></div></template><script setup lang="ts">import {useAppInfoStore} from "../store/mainStore.ts"; const {text, isSupported, copy} = useClipboard(); const props = defineProps({card: {type: Object,default() {return {name: "",url: "",originUrls: [],width: 0,height: 0,aspectRatio: 3 / 4,selected: false, dom: null,};},},});const appInfo = useAppInfoStore();const downloading = ref(false); const copyTagContent = async (content) => {await copy(content);ElMessage({type: "success",grouping: true,center: true,duration: 1000,offset: 80,message: h("p", {style: "display:flex;gap:10px"}, [h("i", {style: "color: teal"}, content),h("span", {style: "color: black"}, "复制成功！"),]),});};const clickHandle = async (e) => {return;};const download = async () => {downloading.value = true;if (props.card.blob != null) {await saveAs(props.card.blob, props.card.name);downloading.value = false;} else {const url = props.card.url;let blob = await getBlobByUrl(url, "Fetch");if (!blob) {blob = await getBlobByUrl(url, "GM");}if (!blob) {blob = await getBlobByUrl(url, "GM", location.origin);}if (blob) {await saveAs(blob, props.card.name);downloading.value = false;} else {downloading.value = false;}}};const toPosition = async () => {const dom = props.card.dom;if (dom != null) {appInfo.container.open = !appInfo.container.open;dom.scrollIntoView({behavior: "smooth",block: "center",inline: "center",});}};</script><style scoped lang="scss">* {border: 0;margin: 0;box-sizing: border-box;user-select: none;-webkit-user-drag: none;}.card {border: 0 !important;margin: 0 !important;padding: 0 !important;scroll-snap-align: start;position: relative;border-radius: 4px;box-shadow: var(--el-box-shadow-dark);aspect-ratio: var(--aspect-ratio);max-width: 100%;max-height: var(--cardMaxHeight);width: calc(var(--cardMaxHeight) * var(--aspect-ratio)) !important;background-color: transparent;overflow: hidden;cursor: pointer;transition: 0.5s;&:hover {box-shadow: 1px 2px 12px 6px rgba(0, 0, 0, 0.5);}.content {border: 0 !important;margin: 0 !important;padding: 0 !important;width: 100%;height: auto;object-position: center;-webkit-user-drag: none;background-position: center;background-repeat: repeat;background-size: contain;}.button-group {transition: 0.5s;& {position: absolute;$padding: 4px;top: $padding;right: $padding;margin: 0;width: 24px;aspect-ratio: 1;max-width: 30px;max-height: 30px;}.button {position: absolute;margin: auto;left: 0;top: 0;right: 0;bottom: 0;font-size: small;box-shadow: var(--el-box-shadow-light);&.download {z-index: 0;}&.toPosition {z-index: 1;}}&:hover {.button.download {transform: translateY(26px);}}}.checkbox {position: absolute !important;height: fit-content;top: 4px !important;left: 4px !important;box-shadow: var(--el-box-shadow-light);}.tag-group {position: absolute;width: 100%;bottom: 4px;left: 4px;display: flex;flex-flow: row wrap;gap: 2px;* {box-shadow: var(--el-box-shadow-light);}}}</style>