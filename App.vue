<template> <div id="onlineGallery-container" ref="container" :data-open="appInfo.container.open" :style="{ '--width': appInfo.window.width * appInfo.container.widthPercentage * 0.01 + 'px', }" > <Body /> <el-button class="onlineGallery-button-close" type="danger" circle @click="appInfo.container.open = false" > <template #icon> <el-icon><i-ep-Close /></el-icon> </template> </el-button> </div> <div class="onlineGallery-child-window-container"> <RuleEditor /> <EagleSaveBox /> <TestBoard v-if="testBoardOpen" @toClose="() => (testBoardOpen = false)" /> </div> <var-fab type="primary" bottom="30vh" right="30px" direction="top" :drag="true" :trigger="isMobile() ? 'click' : 'hover'" :elevation="24" teleport=".onlineGallery-child-window-container" > <template #trigger> <var-badge style="z-index: 1" type="danger" :value="cardsStore.data.cardList.length" :hidden="!cardsStore.data.cardList.length" :max-value="999" > <var-button color="rgb(64,158,255,1)" @dblclick="appInfo.container.open = !appInfo.container.open" class="onlineGallery-float-button" > <IconGirdRound /> </var-button> </var-badge> </template> <template #default> <var-badge style="z-index: 1" type="danger" :value="cardsStore.data.cardList.length" :hidden="!cardsStore.data.cardList.length" :max-value="999" > <var-button type="success" @click="appInfo.container.open = true" round > <IconDashboard /> </var-button> </var-badge> <var-button type="info" @click="ruleEditor.container.open = true" round > <IconBxsBookBookmark /> </var-button> <var-button color="rgb(217, 121, 252)" @click="" round > <IconToolsFill /> </var-button> <var-button color="rgb(117, 121, 252)" @click="testBoardOpen = true" round > <IconTestTube /> </var-button> </template> </var-fab></template><script setup lang="ts"> import IconGirdRound from "@/icon/grid_round.svg?component"; import IconDashboard from "@/icon/dashboard.svg?component"; import IconBxsBookBookmark from "@/icon/bxs-book-bookmark.svg?component"; import IconToolsFill from "@/icon/tools-fill.svg?component"; import IconTestTube from "@/icon/bx-test-tube.svg?component"; const appInfo = useAppInfoStore(); const cardsStore = useCardsStore(); const toolBar = useToolBarStore(); const ruleEditor = useRuleEditorStore(); const container = ref(); const floatButtonRef = ref(); const {x, y, style} = useDraggable(floatButtonRef, { initialValue: {x: 0, y: appInfo.window.height / 2}, preventDefault: true, stopPropagation: true, pointerTypes: ["touch", "mouse", "pen"], }); const testBoardOpen = ref(false); watch( () => appInfo.container.open, (newVal, oldVal) => { if (newVal) { console.log("onlineGallery - 打开"); document.documentElement.dataset.showScrollbar = false.toString(); container.value.focus(); } else { console.log("onlineGallery - 收起"); document.documentElement.dataset.showScrollbar = true.toString(); } } ); onMounted(async () => { await ruleEditor.getLocationRule(); toolBar.selectingInitRule(); ElNotification({ title: "提示", message: h("i", {style: "color: teal"}, "onlineGallery 已加载"), duration: 3000, }); if (appInfo.container.open) { document.documentElement.dataset.showScrollbar = "false"; container.value.focus(); } else { document.documentElement.dataset.showScrollbar = "true"; } });</script><style scoped lang="scss"> * { box-sizing: border-box; border: 0; pointer-events: auto; } $z-index: 2147483646; #onlineGallery-container { box-sizing: border-box; position: fixed !important; z-index: $z-index; padding: 0 30px 20px 30px; margin: 0; left: calc(0px - var(--width)); top: 0 !important; bottom: 0; width: var(--width); max-width: 100vw !important; background-color: rgba(255, 255, 255, 0.8); box-shadow: var(--el-box-shadow-dark); backdrop-filter: blur(2px); display: flex; flex-flow: column; justify-content: start; align-items: center; transition: 0.5s ease; &[data-open="true"] { left: 0px !important; } &:focus { outline: none; } @media (max-width: 500px) { padding: 4px; } } .onlineGallery-button-close { position: absolute; right: 10px; top: 10px; width: fit-content; height: fit-content; box-shadow: var(--el-box-shadow-light); } .onlineGallery-child-window-container { position: fixed !important; z-index: $z-index; } .onlineGallery-float-button { position: relative; width: 46px !important; height: 46px !important; min-width: auto !important; min-height: auto !important; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: xx-large !important; svg { scale: 1.3; } }</style>